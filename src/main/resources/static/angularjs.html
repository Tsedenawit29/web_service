<!DOCTYPE html>
<html lang="en" ng-app="loanManagementApp">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Loan Management System - AngularJS</title>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.8.3/angular.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 50%, #ff6b35 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 15px 40px rgba(0,0,0,0.2);
            padding: 30px;
        }
        
        h1 {
            color: #1e3c72;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }
        
        h2 {
            color: #2a5298;
            margin-bottom: 20px;
        }
        
        .form-section {
            background: linear-gradient(135deg, #e8f4f8 0%, #fff5f0 100%);
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 30px;
            border: 2px solid #2a5298;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            color: #1e3c72;
            font-weight: 600;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #2a5298;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s;
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #ff6b35;
            box-shadow: 0 0 8px rgba(255, 107, 53, 0.3);
        }
        
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        
        button {
            background: linear-gradient(135deg, #2a5298 0%, #1e3c72 100%);
            color: white;
            padding: 12px 28px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }
        
        button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(0,0,0,0.3);
        }
        
        button:active:not(:disabled) {
            transform: translateY(0);
        }
        
        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #ff6b35 0%, #e63946 100%);
        }
        
        .btn-success {
            background: linear-gradient(135deg, #2a5298 0%, #4a90e2 100%);
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: linear-gradient(135deg, #2a5298 0%, #1e3c72 100%);
            color: white;
            padding: 25px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
            transition: transform 0.3s;
        }
        
        .stat-card:nth-child(2) {
            background: linear-gradient(135deg, #ff6b35 0%, #ff8c42 100%);
        }
        
        .stat-card:nth-child(3) {
            background: linear-gradient(135deg, #2a5298 0%, #4a90e2 100%);
        }
        
        .stat-card:nth-child(4) {
            background: linear-gradient(135deg, #ff6b35 0%, #ffa07a 100%);
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
        }
        
        .stat-card h3 {
            font-size: 2.5em;
            margin-bottom: 8px;
        }
        
        .stat-card p {
            opacity: 0.95;
            font-size: 1.1em;
        }
        
        .loans-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        .loans-table th,
        .loans-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        
        .loans-table {
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
        
        .loans-table th {
            background: linear-gradient(135deg, #2a5298 0%, #1e3c72 100%);
            color: white;
            font-weight: 600;
        }
        
        .loans-table tr:hover {
            background: #f0f7ff;
        }
        
        .loans-table tr:last-child td {
            border-bottom: none;
        }
        
        .status-badge {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            display: inline-block;
        }
        
        .status-PENDING {
            background: #ffc107;
            color: #000;
        }
        
        .status-APPROVED {
            background: #28a745;
            color: white;
        }
        
        .status-REJECTED {
            background: #dc3545;
            color: white;
        }
        
        .status-PAID_OFF {
            background: #17a2b8;
            color: white;
        }
        
        .search-section {
            margin-bottom: 25px;
            padding: 20px;
            background: linear-gradient(135deg, #e8f4f8 0%, #fff5f0 100%);
            border-radius: 12px;
            border: 2px solid #ff6b35;
        }
        
        .search-row {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .search-row input,
        .search-row select {
            flex: 1;
            min-width: 150px;
        }
        
        .message {
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        
        .message.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .message.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .action-buttons {
            display: flex;
            gap: 5px;
        }
        
        .action-buttons button {
            padding: 5px 10px;
            font-size: 12px;
        }
        
        .nav-links {
            text-align: center;
            margin-bottom: 25px;
            padding: 15px;
            background: linear-gradient(135deg, #2a5298 0%, #ff6b35 100%);
            border-radius: 10px;
        }
        
        .nav-links a {
            color: white;
            text-decoration: none;
            margin: 0 15px;
            font-weight: 600;
            padding: 8px 15px;
            border-radius: 5px;
            transition: background 0.3s;
        }
        
        .nav-links a:hover {
            background: rgba(255, 255, 255, 0.2);
        }
    </style>
</head>
<body>
    <div class="container" ng-controller="LoanController as ctrl">
        <h1>üè¶ Loan Management System (AngularJS)</h1>
        
        <div class="nav-links">
            <a href="/jquery.html">jQuery Version</a> | 
            <a href="/angularjs.html">AngularJS Version</a> | 
            <a href="/">Home</a>
        </div>
        
        <div class="message" ng-class="{'success': ctrl.messageType === 'success', 'error': ctrl.messageType === 'error'}" 
             ng-show="ctrl.message">
            {{ ctrl.message }}
        </div>
        
        <!-- Statistics Section -->
        <div class="stats">
            <div class="stat-card">
                <h3>{{ ctrl.stats.totalLoans || 0 }}</h3>
                <p>Total Loans</p>
            </div>
            <div class="stat-card">
                <h3>{{ ctrl.stats.pendingLoans || 0 }}</h3>
                <p>Pending Loans</p>
            </div>
            <div class="stat-card">
                <h3>{{ ctrl.stats.approvedLoans || 0 }}</h3>
                <p>Approved Loans</p>
            </div>
            <div class="stat-card">
                <h3>${{ ctrl.stats.totalAmount | number:2 || '0.00' }}</h3>
                <p>Total Amount</p>
            </div>
        </div>
        
        <!-- Loan Form Section -->
        <div class="form-section">
            <h2>{{ ctrl.editingLoan ? 'Edit Loan' : 'Add New Loan' }}</h2>
            <form name="loanForm" ng-submit="ctrl.submitLoan()">
                <div class="form-row">
                    <div class="form-group">
                        <label for="borrowerName">Borrower Name *</label>
                        <input type="text" id="borrowerName" ng-model="ctrl.loan.borrowerName" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="loanAmount">Loan Amount ($) *</label>
                        <input type="number" id="loanAmount" ng-model="ctrl.loan.loanAmount" 
                               step="0.01" min="100" max="1000000" required>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="interestRate">Interest Rate (%) *</label>
                        <input type="number" id="interestRate" ng-model="ctrl.loan.interestRate" 
                               step="0.01" min="0" max="30" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="loanTermMonths">Loan Term (Months) *</label>
                        <input type="number" id="loanTermMonths" ng-model="ctrl.loan.loanTermMonths" 
                               min="1" max="360" required>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="loanType">Loan Type *</label>
                        <select id="loanType" ng-model="ctrl.loan.loanType" required>
                            <option value="">Select Type</option>
                            <option value="PERSONAL">Personal</option>
                            <option value="BUSINESS">Business</option>
                            <option value="MORTGAGE">Mortgage</option>
                            <option value="AUTO">Auto</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="status">Status</label>
                        <select id="status" ng-model="ctrl.loan.status">
                            <option value="PENDING">Pending</option>
                            <option value="APPROVED">Approved</option>
                            <option value="REJECTED">Rejected</option>
                            <option value="PAID_OFF">Paid Off</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="description">Description</label>
                    <textarea id="description" rows="3" ng-model="ctrl.loan.description"></textarea>
                </div>
                
                <button type="submit" ng-disabled="loanForm.$invalid">
                    {{ ctrl.editingLoan ? 'Update Loan' : 'Add Loan' }}
                </button>
                <button type="button" ng-show="ctrl.editingLoan" ng-click="ctrl.cancelEdit()" 
                        style="background: #6c757d;">Cancel</button>
            </form>
        </div>
        
        <!-- Search Section -->
        <div class="search-section">
            <h2>Search Loans</h2>
            <div class="search-row">
                <input type="text" ng-model="ctrl.search.borrowerName" placeholder="Search by borrower name...">
                <select ng-model="ctrl.search.status">
                    <option value="">All Statuses</option>
                    <option value="PENDING">Pending</option>
                    <option value="APPROVED">Approved</option>
                    <option value="REJECTED">Rejected</option>
                    <option value="PAID_OFF">Paid Off</option>
                </select>
                <select ng-model="ctrl.search.loanType">
                    <option value="">All Types</option>
                    <option value="PERSONAL">Personal</option>
                    <option value="BUSINESS">Business</option>
                    <option value="MORTGAGE">Mortgage</option>
                    <option value="AUTO">Auto</option>
                </select>
                <button type="button" ng-click="ctrl.searchLoans()">Search</button>
                <button type="button" ng-click="ctrl.loadAllLoans()">Clear</button>
            </div>
        </div>
        
        <!-- Loans Table -->
        <div>
            <h2>All Loans</h2>
            <table class="loans-table">
                <thead>
                    <tr>
                        <th>Borrower</th>
                        <th>Amount</th>
                        <th>Interest Rate</th>
                        <th>Term (Months)</th>
                        <th>Type</th>
                        <th>Status</th>
                        <th>Monthly Payment</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <tr ng-if="ctrl.loans.length === 0">
                        <td colspan="8" style="text-align: center;">
                            <span ng-if="ctrl.loading">Loading loans...</span>
                            <span ng-if="!ctrl.loading">No loans found</span>
                        </td>
                    </tr>
                    <tr ng-repeat="loan in ctrl.loans">
                        <td>{{ loan.borrowerName }}</td>
                        <td>${{ loan.loanAmount | number:2 }}</td>
                        <td>{{ loan.interestRate }}%</td>
                        <td>{{ loan.loanTermMonths }}</td>
                        <td>{{ loan.loanType }}</td>
                        <td>
                            <span class="status-badge status-{{ loan.status }}">
                                {{ loan.status }}
                            </span>
                        </td>
                        <td>${{ ctrl.calculateMonthlyPayment(loan) | number:2 }}</td>
                        <td class="action-buttons">
                            <button class="btn-success" ng-click="ctrl.editLoan(loan)">Edit</button>
                            <button class="btn-danger" ng-click="ctrl.deleteLoan(loan)">Delete</button>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
    
    <script>
        // AngularJS REST Client for Loan Management System
        // This AngularJS client consumes the Spring-based RESTful web service
        
        angular.module('loanManagementApp', [])
            .controller('LoanController', function($http, $scope) {
                var ctrl = this;
                const API_BASE = '/api/loans';
                
                // Initialize
                ctrl.loans = [];
                ctrl.loan = {};
                ctrl.stats = {};
                ctrl.search = {};
                ctrl.loading = false;
                ctrl.editingLoan = false;
                ctrl.message = '';
                ctrl.messageType = '';
                
                // Load all loans
                ctrl.loadAllLoans = function() {
                    ctrl.loading = true;
                    ctrl.search = {}; // Clear search
                    
                    $http.get(API_BASE)
                        .then(function(response) {
                            ctrl.loans = response.data._embedded ? response.data._embedded.loans : [];
                            ctrl.loading = false;
                        })
                        .catch(function(error) {
                            ctrl.showMessage('Error loading loans: ' + error.data.message, 'error');
                            ctrl.loading = false;
                        });
                };
                
                // Search loans
                ctrl.searchLoans = function() {
                    ctrl.loading = true;
                    let url = API_BASE + '/search?';
                    const params = [];
                    
                    if (ctrl.search.borrowerName) {
                        params.push('borrowerName=' + encodeURIComponent(ctrl.search.borrowerName));
                    }
                    if (ctrl.search.status) {
                        params.push('status=' + encodeURIComponent(ctrl.search.status));
                    }
                    if (ctrl.search.loanType) {
                        params.push('loanType=' + encodeURIComponent(ctrl.search.loanType));
                    }
                    
                    url += params.join('&');
                    
                    $http.get(url)
                        .then(function(response) {
                            ctrl.loans = response.data._embedded ? response.data._embedded.loans : [];
                            ctrl.loading = false;
                        })
                        .catch(function(error) {
                            ctrl.showMessage('Error searching loans: ' + error.data.message, 'error');
                            ctrl.loading = false;
                        });
                };
                
                // Submit loan (create or update)
                ctrl.submitLoan = function() {
                    if (ctrl.editingLoan) {
                        ctrl.updateLoan();
                    } else {
                        ctrl.createLoan();
                    }
                };
                
                // Create loan
                ctrl.createLoan = function() {
                    $http.post(API_BASE, ctrl.loan)
                        .then(function(response) {
                            ctrl.showMessage('Loan created successfully!', 'success');
                            ctrl.resetForm();
                            ctrl.loadAllLoans();
                            ctrl.loadStats();
                        })
                        .catch(function(error) {
                            const errorMsg = error.data ? JSON.stringify(error.data) : error.message;
                            ctrl.showMessage('Error creating loan: ' + errorMsg, 'error');
                        });
                };
                
                // Update loan
                ctrl.updateLoan = function() {
                    $http.put(API_BASE + '/' + ctrl.loan.id, ctrl.loan)
                        .then(function(response) {
                            ctrl.showMessage('Loan updated successfully!', 'success');
                            ctrl.resetForm();
                            ctrl.loadAllLoans();
                            ctrl.loadStats();
                        })
                        .catch(function(error) {
                            ctrl.showMessage('Error updating loan: ' + error.data.message, 'error');
                        });
                };
                
                // Helper function to extract ID from loan object
                ctrl.extractLoanId = function(loan) {
                    if (loan.id) {
                        return loan.id;
                    }
                    // Extract ID from _links.self.href if available
                    if (loan._links && loan._links.self && loan._links.self.href) {
                        const href = loan._links.self.href;
                        const matches = href.match(/\/(\d+)$/);
                        if (matches && matches[1]) {
                            return parseInt(matches[1]);
                        }
                    }
                    return null;
                };
                
                // Edit loan
                ctrl.editLoan = function(loan) {
                    const loanId = ctrl.extractLoanId(loan);
                    if (!loanId) {
                        ctrl.showMessage('Error: Could not extract loan ID', 'error');
                        return;
                    }
                    
                    // Fetch the full loan data to ensure we have all fields
                    $http.get(API_BASE + '/' + loanId)
                        .then(function(response) {
                            ctrl.loan = angular.copy(response.data);
                            ctrl.loan.id = loanId; // Ensure ID is set
                            ctrl.editingLoan = true;
                            
                            // Scroll to form
                            $('html, body').animate({
                                scrollTop: $('.form-section').offset().top
                            }, 500);
                        })
                        .catch(function(error) {
                            ctrl.showMessage('Error loading loan: ' + (error.data ? error.data.message : error.message), 'error');
                        });
                };
                
                // Cancel edit
                ctrl.cancelEdit = function() {
                    ctrl.resetForm();
                };
                
                // Delete loan
                ctrl.deleteLoan = function(loan) {
                    const loanId = typeof loan === 'object' ? ctrl.extractLoanId(loan) : loan;
                    if (!loanId) {
                        ctrl.showMessage('Error: Could not extract loan ID', 'error');
                        return;
                    }
                    
                    if (!confirm('Are you sure you want to delete this loan?')) {
                        return;
                    }
                    
                    $http.delete(API_BASE + '/' + loanId)
                        .then(function() {
                            ctrl.showMessage('Loan deleted successfully!', 'success');
                            ctrl.loadAllLoans();
                            ctrl.loadStats();
                        })
                        .catch(function(error) {
                            ctrl.showMessage('Error deleting loan: ' + (error.data ? error.data.message : error.message), 'error');
                        });
                };
                
                // Load statistics
                ctrl.loadStats = function() {
                    $http.get(API_BASE + '/stats')
                        .then(function(response) {
                            ctrl.stats = response.data;
                        })
                        .catch(function(error) {
                            console.error('Error loading stats:', error);
                        });
                };
                
                // Calculate monthly payment
                ctrl.calculateMonthlyPayment = function(loan) {
                    if (!loan.loanAmount || !loan.interestRate || !loan.loanTermMonths) {
                        return 0;
                    }
                    
                    const monthlyRate = loan.interestRate / 100 / 12;
                    const principal = loan.loanAmount;
                    const months = loan.loanTermMonths;
                    
                    if (monthlyRate === 0) {
                        return principal / months;
                    }
                    
                    return principal * (monthlyRate * Math.pow(1 + monthlyRate, months)) 
                           / (Math.pow(1 + monthlyRate, months) - 1);
                };
                
                // Reset form
                ctrl.resetForm = function() {
                    ctrl.loan = {
                        status: 'PENDING'
                    };
                    ctrl.editingLoan = false;
                };
                
                // Show message
                ctrl.showMessage = function(message, type) {
                    ctrl.message = message;
                    ctrl.messageType = type;
                    
                    setTimeout(function() {
                        ctrl.message = '';
                        ctrl.messageType = '';
                        $scope.$apply();
                    }, 5000);
                };
                
                // Initialize on load
                ctrl.loadAllLoans();
                ctrl.loadStats();
            });
    </script>
</body>
</html>


